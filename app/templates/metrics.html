{% extends "base.html" %}

{% block title %}System Metrics{% endblock %}

{% block content %}
<h2>üìà System Metrics</h2>

<style>
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .metric-card {
        background: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        transition: all 0.2s;
    }

    .metric-card:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .metric-card h3 {
        margin: 0 0 15px 0;
        font-size: 1.1em;
        color: #333;
    }

    .metric-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
        font-size: 0.95em;
    }

    .metric-row:last-child {
        border-bottom: none;
    }

    .metric-label {
        color: #666;
    }

    .metric-value {
        font-weight: bold;
        color: #0066cc;
        font-size: 1.1em;
    }

    .section-title {
        margin-top: 30px;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #0066cc;
        color: #0066cc;
        font-size: 1.3em;
    }

    .stat-highlight {
        background: #fff9e6;
        border-left: 4px solid #ff9800;
        padding: 15px;
        margin: 15px 0;
        border-radius: 4px;
    }

    .stat-highlight strong {
        color: #ff9800;
    }
</style>

<!-- Captures Summary -->
<div class="section-title">üì¶ Captures</div>
<div class="metrics-grid">
    <div class="metric-card">
        <h3>By Decision Status</h3>
        {% for status, count in metrics.captures.by_decision_status.items() %}
        <div class="metric-row">
            <span class="metric-label">{{ status|title }}</span>
            <span class="metric-value">{{ count }}</span>
        </div>
        {% endfor %}
    </div>

    <div class="metric-card">
        <h3>By Commit Status</h3>
        {% for status, count in metrics.captures.by_commit_status.items() %}
        <div class="metric-row">
            <span class="metric-label">{{ status|title }}</span>
            <span class="metric-value">{{ count }}</span>
        </div>
        {% endfor %}
    </div>

    <div class="metric-card">
        <h3>By Clarify Status</h3>
        {% for status, count in metrics.captures.by_clarify_status.items() %}
        <div class="metric-row">
            <span class="metric-label">{{ status|title }}</span>
            <span class="metric-value">{{ count }}</span>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Pending Work -->
<div class="section-title">‚è≥ Pending Work</div>
<div class="metrics-grid">
    <div class="metric-card">
        <h3>Awaiting Action</h3>
        {% for label, count in metrics.pending_work.items() %}
        <div class="metric-row">
            <span class="metric-label">{{ label|replace('_', ' ')|title }}</span>
            <span class="metric-value">{{ count }}</span>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Recent Failures -->
{% if metrics.recent_failures %}
<div class="section-title">‚ö†Ô∏è Recent Failures</div>
<div class="stat-highlight">
    <strong>Last 24 hours:</strong> {{ metrics.recent_failures.count }} failure(s)
    {% if metrics.recent_failures.by_type %}
    <br><br>
    <strong>By type:</strong>
    <ul style="margin: 10px 0; padding-left: 20px;">
        {% for failure_type, count in metrics.recent_failures.by_type.items() %}
        <li>{{ failure_type|title }}: {{ count }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

<!-- System Info -->
<div class="section-title">üñ•Ô∏è System Information</div>
<div class="metrics-grid">
    <div class="metric-card">
        <h3>System Status</h3>
        <div class="metric-row">
            <span class="metric-label">Running</span>
            <span class="metric-value">{% if metrics.system.running %}‚úÖ Yes{% else %}‚ùå No{% endif %}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Version</span>
            <span class="metric-value">{{ metrics.system.version }}</span>
        </div>
        <div class="metric-row">
            <span class="metric-label">Timestamp</span>
            <span class="metric-value" style="font-size: 0.9em;">{{ metrics.timestamp }}</span>
        </div>
    </div>
</div>

<div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; font-size: 0.9em; color: #999;">
    <p>üìä Metrics are updated in real-time. Use these values to monitor system health and performance.</p>
</div>

{% endblock %}
