{% extends "base.html" %}

{% block title %}Pending approvals{% endblock %}

{% block content %}
<h2>Pending approvals</h2>

<!-- RTM Auth Status Banner -->
<div style="margin-bottom: 20px; padding: 15px; border-radius: 4px; {% if rtm_auth_valid %}background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724;{% else %}background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24;{% endif %}">
    {% if rtm_auth_valid %}
        <strong>✓ Remember The Milk connected</strong> - Approved tasks will be synced to RTM
    {% else %}
        <strong>⚠ Remember The Milk not connected</strong> - Approved tasks will not be synced to RTM
        <form method="post" action="/rtm/auth/start" style="display: inline-block; margin-left: 10px;">
            <button type="submit" style="padding: 5px 10px; cursor: pointer;">Connect Remember The Milk</button>
        </form>
    {% endif %}
</div>

{% if captures %}
<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>Created</th>
        <th>Source</th>
        <th>Clarified summary</th>
        <th>Confidence</th>
        <th>Status</th>
        <th></th>
    </tr>
    </thead>
    <tbody>
    {% for c in captures %}
        {% set clar = c.clar_dict %}
        <tr>
            <td>{{ c.id }}</td>
            <td>{{ c.created_at }}</td>
            <td>{{ c.source }}</td>
            <td>
                {% if clar %}
                    {% if 'clarified_text' in clar and clar['clarified_text'] %}
                        {{ clar['clarified_text'] }}
                    {% elif 'next_action' in clar and clar['next_action'] %}
                        {{ clar['next_action'] }}
                    {% else %}
                        <em>No clarified text</em>
                    {% endif %}
                {% else %}
                    <em>No clarification yet</em>
                {% endif %}
            </td>
            <td>
                {% if clar and 'confidence_score' in clar and clar['confidence_score'] is not none %}
                    <span class="confidence">{{ "%.2f"|format(clar['confidence_score']) }}</span>
                {% else %}
                    <em>n/a</em>
                {% endif %}
            </td>
            <td>
                {% if c.decision_status == "proposed" %}
                    <span style="color: #ff9800;">{{ c.status_label }}</span>
                {% elif c.decision_status == "approved" %}
                    <span style="color: #2196f3;">{{ c.status_label }}</span>
                {% endif %}
            </td>
            <td><a href="/approvals/{{ c.id }}">Open</a></td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>No captures awaiting action. All approvals have been completed.</p>
{% endif %}

{% endblock %}

