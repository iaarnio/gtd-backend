{% extends "base.html" %}

{% block title %}Capture {{ capture.id }}{% endblock %}

{% block content %}
<h2>Pending approvals</h2>

<h3>Capture {{ capture.id }}</h3>

<p>
    <span class="badge badge-{{ capture.decision_status }}">
        {{ capture.decision_status }}
    </span>
    &nbsp;Created: {{ capture.created_at }} â€” Source: {{ capture.source }}
</p>

{% if capture.source_link %}
<p>
    <a href="{{ capture.source_link }}" target="_blank" rel="noopener noreferrer">
        Open original
    </a>
</p>
{% endif %}

{% set clar = clar_dict %}

<style>
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 20px 0;
}

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }
}

.form-field {
    display: flex;
    flex-direction: column;
}

.form-field label {
    font-weight: bold;
    margin-bottom: 5px;
}

.form-field input,
.form-field select,
.form-field textarea {
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

.task-row {
    display: flex;
    gap: 10px;
    align-items: center;
}

.task-row input {
    flex: 1;
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 8px;
}

.button-group {
    display: flex;
    gap: 10px;
    margin: 30px 0;
}

.button-group button {
    flex: 1;
    padding: 15px;
    font-size: 16px;
    font-weight: bold;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

.approve { background: #4CAF50; color: white; }
.save { background: #FDD835; color: black; }
.reject { background: #F44336; color: white; }

@media (max-width: 768px) {
    .button-group {
        position: sticky;
        bottom: 0;
        background: white;
        padding: 10px;
        border-top: 1px solid #ddd;
        z-index: 100;
    }
}
</style>

<form method="post">

    <div class="form-grid">

        <!-- LEFT -->
        <div>

            <div class="form-field">
                <label>Project</label>
                <input type="text" name="project_name"
                       value="{{ clar.get('project_name', '') or '' }}">
            </div>

            <div class="form-field">
                <label>Project short name</label>
                <input type="text" name="project_shortname"
                       value="{{ clar.get('project_shortname', '') or '' }}"
                       style="text-transform: uppercase;">
            </div>

            <div class="form-field">
                <label>Task</label>
                <div class="task-row">
                    <input type="text" name="next_action"
                           value="{{ next_action_prefill or '' }}">

                    <div class="checkbox-group">
                        <label>NA</label>
                        <input type="checkbox"
                               name="is_next_action"
                               {% if clar.get('type') == 'next_action' %}checked{% endif %}>
                    </div>
                </div>
            </div>

        </div>

        <!-- RIGHT -->
        <div>

            <div class="form-field">
                <label>Context</label>
                <select name="suggested_context">
                    <option value="">-- None --</option>
                    <option value="Work" {% if clar.get('suggested_context') == 'Work' %}selected{% endif %}>Work</option>
                    <option value="Home" {% if clar.get('suggested_context') == 'Home' %}selected{% endif %}>Home</option>
                    <option value="Phone" {% if clar.get('suggested_context') == 'Phone' %}selected{% endif %}>Phone</option>
                    <option value="Computer" {% if clar.get('suggested_context') == 'Computer' %}selected{% endif %}>Computer</option>
                    <option value="Errands" {% if clar.get('suggested_context') == 'Errands' %}selected{% endif %}>Errands</option>
                    <option value="Waiting" {% if clar.get('suggested_context') == 'Waiting' %}selected{% endif %}>Waiting</option>
                </select>
            </div>

            <div class="form-field">
                <label>Due Date</label>
                <input type="date" name="due_date"
                       value="{{ clar.get('due_date', '') or '' }}">
            </div>

            <div class="form-field">
                <label>Notes</label>
                <textarea name="notes">{{ clar.get('notes', '') or '' }}</textarea>
            </div>

        </div>

    </div>

    {% if capture.decision_status == "proposed" %}
    <div class="button-group">

        <button type="submit"
                class="approve"
                formaction="/approvals/{{ capture.id }}/approve">
            Approve
        </button>

        <button type="submit"
                class="save"
                formaction="/approvals/{{ capture.id }}/clarification">
            Save
        </button>

        <button type="submit"
                class="reject"
                formaction="/approvals/{{ capture.id }}/reject">
            Reject
        </button>

    </div>
    {% else %}
        <p><em>This capture has already been {{ capture.decision_status }}.</em></p>
    {% endif %}

    <h4>Raw text</h4>
    <pre>{{ capture.raw_text }}</pre>

</form>

{% endblock %}
